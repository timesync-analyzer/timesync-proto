syntax = "proto3";

option go_package = "timesync-analyzer/protocol/generated;monitoring";

import "google/protobuf/timestamp.proto";

message MetricsWrapper {
    MessageType type = 1;
    google.protobuf.Timestamp timestamp = 2;
    string node_name = 3;

    oneof payload {
        Ptp4lMetrics ptp4l = 10;
        Phc2SysMetrics phc2sys = 11;
        SystemMetrics system = 12;
        NodeInfo node_info = 13;
    }
}

enum MessageType {
    MESSAGE_TYPE_UNSPECIFIED = 0;
    MESSAGE_TYPE_PTP4L = 1;
    MESSAGE_TYPE_PHC2SYS = 2;
    MESSAGE_TYPE_SYSTEM = 3;
    MESSAGE_TYPE_NODE_INFO = 4;
}

enum NodeType {
    NODE_TYPE_UNSPECIFIED = 0;
    NODE_TYPE_MASTER = 1;
    NODE_TYPE_SLAVE = 2;
}

message NodeInfo {
    string net_interface = 2;
    string ip_address = 3;
    NodeType node_type = 4;
}

message Ptp4lMetrics {
    int64 offset_ns = 1;
    int64 frequency = 2;
    int64 path_delay = 3;
    int32 state = 4;
};

message Phc2SysMetrics {
    int64 offset_ns = 1;
    int64 frequency = 2;
    int64 path_delay = 3;
    int32 state = 4;
};

message NetworkMetrics {
    uint64 rx_packets = 1;
    uint64 tx_packets = 2;
    uint64 rx_dropped = 3;
    uint64 tx_dropped = 4;
    uint64 rx_errors = 5;
    uint64 tx_errors = 6;
    uint64 collisions = 7;
};

message CpuMetrics {
    double usage_percent = 1;
    uint64 context_switches = 2;
    uint64 interrupts = 3;
    uint64 softirqs = 4;
};

message MemoryMetrics {
    uint64 mem_available_kb = 1;
    uint64 mem_free_kb = 2;
    uint64 swap_total_kb = 3;
    uint64 swap_free_kb = 4;
    uint64 buffers_kb = 5;
};

message TemperatureMetrics {
    message TemperatureMetric {
        string sensor = 1;
        string label = 2;
        int32 temperature = 3;
    };
    repeated TemperatureMetric zones_readings = 1;
};

message SystemMetrics {
    TemperatureMetrics temperatureStats = 2;
    NetworkMetrics networkStats = 3;
    CpuMetrics cpuStats = 4;
    MemoryMetrics memoryStats = 5;
};